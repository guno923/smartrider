<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace가 인터페이스와 일치해야 연결된다 -->
<mapper namespace="com.smart.rider.goods.mapper.GoodsPurchaseMapper">
	<!-- 코드자동증가 -->
	<select id="purchaseCodeCount" resultType="String">
		SELECT 
			MAX(LPAD(RIGHT(purchase_code, 4)+1, 4 , '0')) 
		FROM purchase;
	</select>
	
	<resultMap type="com.smart.rider.goods.dto.GoodsPurchaseDTO" id="ASid">
    	<result column="purchase_code"     property="purchaseCode"/>
    	<result column="account_code"     property="accountCode"/>
    	<result column="contract_shop_code"     		property="contractShopCode"/>
    	<result column="goods_database_code"    	property="goodsDbCode"/>
    	<result column="purchase_pay" 		property="purchasePay"/>
    	<result column="purchase_state"     property="purchaseState"/>
    	<result column="purchase_date"	 	property="purchaseDate"/>
    	
	</resultMap>
	
	<select id="getPurchaseList" resultMap="ASid" resultType="com.smart.rider.goods.dto.GoodsPurchaseDTO" parameterType="String">
	SELECT *
			FROM
			purchase p			 
			INNER JOIN 
			goods_database gb
			ON 
			gb.goods_database_code = p.goods_database_code
			INNER JOIN 
			goods g
			ON
			g.purchase_code = p.purchase_code
			WHERE 
		p.purchase_code = #{purchaseCode}
					
	</select>
	
	<select id="purchaseList" resultMap="ASid" resultType="com.smart.rider.goods.dto.GoodsPurchaseDTO" parameterType="String">
	SELECT *
			FROM
			purchase p			 
			INNER JOIN 
			goods_database gb
			ON 
			gb.goods_database_code = p.goods_database_code
			INNER JOIN 
			account a
			ON p.account_code = a.account_code
					
	</select>
	
	<!-- 매입 INSERT -->
	<insert id="purchaseInsert" parameterType="com.smart.rider.goods.dto.GoodsPurchaseDTO">
		INSERT INTO purchase
			(purchase_code
			, account_code
			, contract_shop_code
			, goods_database_code
			, purchase_pay
			, purchase_state
			, purchase_date)
			VALUES 
			(#{purchaseCode}
			, #{accountCode}
			, #{contractShopCode}
			, #{goodsDbCode}
			, #{purchasePay}
			, #{purchaseState}
			, NOW()
			)
	</insert>
</mapper>