<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smart.rider.goods.mapper.GoodsMapper">
	<!-- 상품DB상세조회  -->
	
	<select id="getGoodsDbCode" resultType="com.smart.rider.goods.dto.GoodsdbDTO">
		SELECT
		goods_database_code AS goodsDbCode,
		m.member_id AS memberId,
		goods_database_name AS goodsDbName,
		goods_database_category AS	goodsDbCategory,
		goods_database_number AS goodsDbNumber,
		goods_database_color AS goodsDbColor,
		goods_database_weight AS goodsDbWeight,
		goods_database_speed AS goodsDbSpeed,
		goods_database_size AS goodsDbSize,
		goods_database_nation AS goodsDbNation,
		goods_database_load AS goodsDbLoad,
		goods_database_distance AS goodsDbDistance,
		goods_database_battery AS	goodsDbBattery,
		goods_database_time AS goodsDbTime,
		goods_database_made	AS goodsDbMade,
		goods_database_description AS goodsDbDescription,
		goods_database_image AS goodsDbImage,
		goods_database_date AS goodsDbDate
		FROM
		 goods_database gdb INNER JOIN member m 
			ON gdb.member_id = m.member_id		
		WHERE 
		goods_database_code = #{goodsDbCode}
	</select>
	<!-- 상품등록  -->
	<insert id="goodsInsert" parameterType="com.smart.rider.goods.dto.GoodsDTO">		
			INSERT INTO goods
			(
			goods_code AS goodsCode
			, goods_database_code AS goodsDbCode
			, purchase_code AS purchaseCode
			, contract_shop_code AS contractShopCode
			, goods_pay AS goodsPay
			, goods_position AS goodsPosition
			, goods_rental AS goodsRental
			, goods_state AS goodsState
			, goods_completion_state AS goodsCompletionState
			, goods_rental_state AS goodsRentalState
			, goods_inventory_date AS goodsInventoryDate
			, goods_date AS goodsDate
			)
		VALUES
		 (#{goodsCode}
		 , #{goodsDbCode}
		 , #{purchaseCode}
		 , #{contractShopCode}
		 , #{goodsPay}
		 , #{goodsPosition}
		 , #{goodsRental}
		 , #{goodsState}
		 , #{goodsCompletionState}
		 , #{goodsRentalState}
		 , NOW()
		 , NOW())
	</insert>

	<select id="goodsCodeCount" resultType="String">
		SELECT 
			MAX(LPAD(RIGHT(subject_code, 4)+1, '4' , '0')) 
		FROM subject;
	</select>
			

	<select id="goodsList"	resultType="com.smart.rider.goods.dto.GoodsDTO">
			SELECT
			g.goods_code AS goodsCode,
			g.goods_database_code AS goodsDbCode,
			gdb.goods_database_code AS goodsDbCode,
			g.purchase_code AS	purchaseCode,
			p.purchase_code AS purchaseCode,
			g.contract_shop_code AS	contractShopCode,
			sr.contract_shop_code AS contractShopCode,
			goods_pay AS goodsPay,
			goods_position AS goodsPosition,
			goods_rental AS	goodsRental,
			goods_state AS goodsState,
			goods_completion_state AS	goodsCompletionState,
			goods_rental_state AS goodsRentalState,
			goods_inventory_date AS goodsInventoryDate,
			goods_date AS goodsDate
			FROM goods g INNER JOIN goods_database gdb 
			INNER JOIN	purchase p 
			INNER JOIN shop_relation sr
			ON g.goods_database_code = gdb.goods_database_code and
			g.purchase_code = p.purchase_code and
			g.contract_shop_code = sr.contract_shop_code
	</select>
</mapper>