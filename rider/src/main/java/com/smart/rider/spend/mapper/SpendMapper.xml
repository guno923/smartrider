<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smart.rider.spend.mapper.SpendMapper">

	<resultMap type="com.smart.rider.spend.dto.SpendAdminDTO" id="spendAdminMap">
		<result column="shop_code" 					property="shopCode"/>
		<result column="contract_code" 				property="contractCode"/>
		<result column="member_id"					property="memberId"/>
		<result column="shop_name" 					property="shopName"/>
		<result column="shop_address" 				property="shopAddress"/>
		<result column="shop_phone" 				property="shopPhone"/>
		<result column="shop_date" 					property="shopDate"/>
		<result column="contract_unit_code" 		property="contractUnitCode"/>
		<result column="contract_start" 			property="contractStart"/>
		<result column="contract_finish" 			property="contractFinish"/>
		<result column="contract_date" 				property="contractDate"/>
		<result column="contract_valid_date" 		property="contractValidDate"/>
		<result column="contract_management_state"	property="contractManagementState"/>
		<result column="contract_shop_code"			property="contractShopCode"/>
		<result column="member_birth"				property="memberBirth"/>
	</resultMap>
	
	<!-- 191004 재욱, Read : 관리자 확인 카운트, 2일 때 관리자 비밀번호와 점주 생년월일 일치 -->
	<select id="spendAdminCheck" resultType="int" parameterType="String">
		SELECT 
			COUNT(DISTINCT m.member_id)
		FROM member m, shop s
		WHERE s.shop_code = #{shopCode} AND m.member_birth = #{memberBirth} 
		OR m.member_id = 'id001' AND m.member_pw = #{adminPw}
	</select>
	
	<!-- 191004 재욱, Read : 계약된 매장 리스트 상세보기 -->
	<select id="spendAdminDetails" resultMap="spendAdminMap" parameterType="String">
		SELECT
			 s.shop_code
			,s.member_id
			,s.shop_name
			,cm.contract_management_state
			,s.shop_address
			,s.shop_phone
			,s.shop_date
			,c.contract_start
			,c.contract_finish
			,c.contract_valid_date
			,c.contract_date
			,m.member_birth
		FROM shop s, contract c, contract_management cm, member m
		WHERE s.member_id = c.member_id 
		AND s.contract_code = cm.contract_code 
		AND c.member_id = m.member_id
		AND s.shop_code = #{shopCode};
	</select>

	<!-- 191004 재욱, Read : 계약된 매장 리스트 -->
	<select id="spendAdmin" resultMap="spendAdminMap">
		SELECT 
			 s.shop_code
			,s.member_id
			,s.shop_name
			,cm.contract_management_state
			,sr.contract_shop_code
		FROM shop s, contract_management cm, shop_relation sr
		WHERE s.contract_code = cm.contract_code AND sr.member_id = s.member_id
	</select>
</mapper>