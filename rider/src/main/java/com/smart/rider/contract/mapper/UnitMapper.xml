<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace가 인터페이스와 일치해야 연결된다 -->
<mapper namespace="com.smart.rider.contract.mapper.UnitMapper">
	<select id="UnitList"
		resultType="com.smart.rider.contract.dto.UnitDTO">
		SELECT
		contract_unit_code AS contractUnitCode
		, member_id AS memberId
		, contract_unit_month AS contractUnitMonth
		, contract_unit_oneyear AS contractUnitOneyear
		, contract_unit_twoyear AS contractUnitTwoyear
		, contract_unit_date AS contractUnitDate

		FROM contract_unit
	</select>
	<select id="contractUnitCode" resultType="int">
			SELECT 
			MAX(CAST(substring(contract_unit_code,19) AS DECIMAL)) 
			AS maxcol 
			FROM contract_unit
	</select>	
	<insert id="unitInsert" parameterType="com.smart.rider.contract.dto.UnitDTO">
		<selectKey keyProperty="contractUnitCode" resultType="String" order="BEFORE">
			SELECT 
			CONCAT('goods_', MAX(CAST(substring(contract_unit_code,19) AS DECIMAL)+1)) 
			AS contractUnitCode 
			FROM contract_unit
		</selectKey>
		INSERT INTO contract_unit
			(	contract_unit_code,
			 	member_id, contract_unit_month,
			 	contract_unit_oneyear,
			 	contract_unit_twoyear,
			 	contract_unit_date)
		VALUES ( 				
				#{contractUnitCode},
				#{memberId},
			 	#{contractUnitMonth},
			 	#{contractUnitOneyear},
		 	  	#{contractUnitTwoyear},
		 	    NOW())
	</insert>


</mapper>