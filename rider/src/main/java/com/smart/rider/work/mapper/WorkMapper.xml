<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smart.rider.work.mapper.WorkMapper">
	<select id="employeeCheck" parameterType="String" resultType="com.smart.rider.member.dto.MemberDTO">
		SELECT 
			 member_id AS memberId
			,member_pw AS memberPw
			,member_name AS memberName
			,member_level AS memberLevel
			,contract_shop_code AS contractShopCode
		FROM member
		WHERE member_id = #{memberId} and member_pw = #{memberPw}
	</select>
	<!-- 코드 자동증가 -->
	<select id="workCodeCount" resultType="String">
		SELECT 
			MAX(LPAD(RIGHT(work_code, 4)+1, '4' , '0')) 
		FROM work;
	</select>
	<insert id="goInsert" parameterType="com.smart.rider.work.dto.WorkDTO">
		INSERT INTO work(
				 work_code
				,contract_shop_code
				,member_id
				,work_start
				,work_finish
				,work_today
				,work_date
			)VALUES (
				 #{workCode}
				,#{contractShopCode}
				,#{memberId}
				,NOW()
				,0
				,0
				,NOW())
	</insert>
	<select id="workList" resultType="com.smart.rider.work.dto.WorkDTO">
		SELECT 
			 w.work_code AS workCode
			,w.contract_shop_code AS contractShopCode
			,w.member_id AS memberId
			,w.work_start AS workStart
			,w.work_finish AS workFinish
			,w.work_today AS workToday
			,w.work_rest AS workRest
			,w.work_date AS workDate
			,m.member_name AS memberName
		FROM 
			work w
		INNER JOIN
			member m			 
		INNER JOIN 
			shop_relation s
		ON 
			m.member_id = w.member_id			
		AND s.contract_shop_code = w.contract_shop_code
		AND s.contract_shop_code = m.contract_shop_code
		ORDER BY w.work_date DESC 
		LIMIT #{startRow},#{rowPerPage}
	</select>
	<update id="leaveInsert" parameterType="com.smart.rider.work.dto.WorkDTO">
		UPDATE work
		SET
			work_finish	=NOW(),
			work_today	=TIMEDIFF(CURTIME(),work_start)
		WHERE 
			member_id = #{memberId}
		AND CURDATE()
	</update>
	<!-- 19.10.02페이지작업위한작성  -->
	<select id="getWorkAllCount" resultType="int">
		SELECT
			COUNT(*)
		FROM work
	</select>
</mapper>